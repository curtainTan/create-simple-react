{"id":"MClV","dependencies":[{"name":"E:\\xue\\2020\\前端\\myReact\\react-simple\\.babelrc","includedInParent":true,"mtime":1582250324690},{"name":"E:\\xue\\2020\\前端\\myReact\\react-simple\\package.json","includedInParent":true,"mtime":1582392014887},{"name":"../react-dom/index","loc":{"line":7,"column":32},"parent":"E:\\xue\\2020\\前端\\myReact\\react-simple\\react\\setState_queue.js","resolved":"E:\\xue\\2020\\前端\\myReact\\react-simple\\react-dom\\index.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.enqueueSetState=s;var e=require(\"../react-dom/index\"),t=[],n=[];function r(e){return Promise.resolve().then(e)}function s(e,s){0===t.length&&r(o),t.push({stateChange:e,component:s}),n.some(function(e){return e===s})||n.push(s)}function o(){for(var r,s;r=t.shift();){var o=r,a=o.stateChange,i=o.component;i.prevState||(i.prevState=Object.assign({},i.state)),\"function\"==typeof a?Object.assign(i.state,a(i.prevState,i.props)):Object.assign(i.state,a),i.prevState=i.state}for(;s=n.shift();)(0,e.renderComponent)(s)}"},"sourceMaps":{"js":{"mappings":[{"source":"react/setState_queue.js","original":{"line":65,"column":1},"generated":{"line":1,"column":0}},{"source":"react/setState_queue.js","original":{"line":65,"column":1},"generated":{"line":1,"column":13}},{"source":"react/setState_queue.js","original":{"line":65,"column":1},"generated":{"line":1,"column":20}},{"source":"react/setState_queue.js","original":{"line":65,"column":1},"generated":{"line":1,"column":35}},{"source":"react/setState_queue.js","original":{"line":65,"column":1},"generated":{"line":1,"column":43}},{"source":"react/setState_queue.js","original":{"line":65,"column":1},"generated":{"line":1,"column":56}},{"source":"react/setState_queue.js","original":{"line":65,"column":1},"generated":{"line":1,"column":57}},{"source":"react/setState_queue.js","original":{"line":65,"column":1},"generated":{"line":1,"column":64}},{"source":"react/setState_queue.js","original":{"line":65,"column":1},"generated":{"line":1,"column":68}},{"source":"react/setState_queue.js","original":{"line":65,"column":1},"generated":{"line":1,"column":76}},{"source":"react/setState_queue.js","original":{"line":65,"column":1},"generated":{"line":1,"column":92}},{"source":"react/setState_queue.js","original":{"line":7,"column":0},"generated":{"line":1,"column":94}},{"source":"react/setState_queue.js","original":{"line":7,"column":0},"generated":{"line":1,"column":98}},{"source":"react/setState_queue.js","original":{"line":7,"column":0},"generated":{"line":1,"column":100}},{"source":"react/setState_queue.js","original":{"line":7,"column":0},"generated":{"line":1,"column":108}},{"source":"react/setState_queue.js","name":"setStateQueue","original":{"line":9,"column":6},"generated":{"line":1,"column":130}},{"source":"react/setState_queue.js","original":{"line":9,"column":22},"generated":{"line":1,"column":132}},{"source":"react/setState_queue.js","name":"renderQueue","original":{"line":11,"column":6},"generated":{"line":1,"column":135}},{"source":"react/setState_queue.js","original":{"line":11,"column":20},"generated":{"line":1,"column":137}},{"source":"react/setState_queue.js","original":{"line":13,"column":0},"generated":{"line":1,"column":140}},{"source":"react/setState_queue.js","name":"defer","original":{"line":13,"column":9},"generated":{"line":1,"column":149}},{"source":"react/setState_queue.js","name":"fn","original":{"line":13,"column":16},"generated":{"line":1,"column":151}},{"source":"react/setState_queue.js","name":"Promise","original":{"line":14,"column":11},"generated":{"line":1,"column":154}},{"source":"react/setState_queue.js","name":"Promise","original":{"line":14,"column":11},"generated":{"line":1,"column":161}},{"source":"react/setState_queue.js","name":"resolve","original":{"line":14,"column":19},"generated":{"line":1,"column":169}},{"source":"react/setState_queue.js","name":"then","original":{"line":14,"column":29},"generated":{"line":1,"column":179}},{"source":"react/setState_queue.js","name":"fn","original":{"line":14,"column":35},"generated":{"line":1,"column":184}},{"source":"react/setState_queue.js","original":{"line":17,"column":7},"generated":{"line":1,"column":187}},{"source":"react/setState_queue.js","name":"enqueueSetState","original":{"line":17,"column":16},"generated":{"line":1,"column":196}},{"source":"react/setState_queue.js","name":"stateChange","original":{"line":17,"column":33},"generated":{"line":1,"column":198}},{"source":"react/setState_queue.js","name":"component","original":{"line":17,"column":46},"generated":{"line":1,"column":200}},{"source":"react/setState_queue.js","original":{"line":19,"column":33},"generated":{"line":1,"column":203}},{"source":"react/setState_queue.js","name":"setStateQueue","original":{"line":19,"column":8},"generated":{"line":1,"column":207}},{"source":"react/setState_queue.js","name":"length","original":{"line":19,"column":22},"generated":{"line":1,"column":209}},{"source":"react/setState_queue.js","name":"defer","original":{"line":20,"column":8},"generated":{"line":1,"column":217}},{"source":"react/setState_queue.js","name":"flush","original":{"line":20,"column":15},"generated":{"line":1,"column":219}},{"source":"react/setState_queue.js","name":"setStateQueue","original":{"line":27,"column":4},"generated":{"line":1,"column":222}},{"source":"react/setState_queue.js","name":"push","original":{"line":27,"column":18},"generated":{"line":1,"column":224}},{"source":"react/setState_queue.js","original":{"line":27,"column":23},"generated":{"line":1,"column":229}},{"source":"react/setState_queue.js","name":"stateChange","original":{"line":28,"column":8},"generated":{"line":1,"column":230}},{"source":"react/setState_queue.js","name":"stateChange","original":{"line":28,"column":8},"generated":{"line":1,"column":242}},{"source":"react/setState_queue.js","name":"component","original":{"line":29,"column":8},"generated":{"line":1,"column":244}},{"source":"react/setState_queue.js","name":"component","original":{"line":29,"column":8},"generated":{"line":1,"column":254}},{"source":"react/setState_queue.js","name":"renderQueue","original":{"line":32,"column":14},"generated":{"line":1,"column":258}},{"source":"react/setState_queue.js","name":"some","original":{"line":32,"column":26},"generated":{"line":1,"column":260}},{"source":"react/setState_queue.js","original":{"line":32,"column":32},"generated":{"line":1,"column":265}},{"source":"react/setState_queue.js","name":"item","original":{"line":32,"column":32},"generated":{"line":1,"column":274}},{"source":"react/setState_queue.js","name":"item","original":{"line":33,"column":15},"generated":{"line":1,"column":277}},{"source":"react/setState_queue.js","name":"item","original":{"line":33,"column":15},"generated":{"line":1,"column":284}},{"source":"react/setState_queue.js","name":"component","original":{"line":33,"column":24},"generated":{"line":1,"column":288}},{"source":"react/setState_queue.js","name":"renderQueue","original":{"line":37,"column":8},"generated":{"line":1,"column":293}},{"source":"react/setState_queue.js","name":"push","original":{"line":37,"column":20},"generated":{"line":1,"column":295}},{"source":"react/setState_queue.js","name":"component","original":{"line":37,"column":26},"generated":{"line":1,"column":300}},{"source":"react/setState_queue.js","original":{"line":42,"column":0},"generated":{"line":1,"column":303}},{"source":"react/setState_queue.js","name":"flush","original":{"line":42,"column":9},"generated":{"line":1,"column":312}},{"source":"react/setState_queue.js","name":"item","original":{"line":44,"column":11},"generated":{"line":1,"column":316}},{"source":"react/setState_queue.js","name":"item","original":{"line":43,"column":8},"generated":{"line":1,"column":320}},{"source":"react/setState_queue.js","name":"item","original":{"line":43,"column":8},"generated":{"line":1,"column":324}},{"source":"react/setState_queue.js","name":"component","original":{"line":43,"column":14},"generated":{"line":1,"column":326}},{"source":"react/setState_queue.js","name":"item","original":{"line":44,"column":11},"generated":{"line":1,"column":328}},{"source":"react/setState_queue.js","name":"setStateQueue","original":{"line":44,"column":18},"generated":{"line":1,"column":330}},{"source":"react/setState_queue.js","name":"shift","original":{"line":44,"column":32},"generated":{"line":1,"column":332}},{"source":"react/setState_queue.js","original":{"line":44,"column":41},"generated":{"line":1,"column":341}},{"source":"react/setState_queue.js","name":"item","original":{"line":45,"column":43},"generated":{"line":1,"column":342}},{"source":"react/setState_queue.js","name":"item","original":{"line":45,"column":43},"generated":{"line":1,"column":346}},{"source":"react/setState_queue.js","name":"item","original":{"line":45,"column":43},"generated":{"line":1,"column":348}},{"source":"react/setState_queue.js","name":"stateChange","original":{"line":45,"column":16},"generated":{"line":1,"column":350}},{"source":"react/setState_queue.js","name":"stateChange","original":{"line":45,"column":16},"generated":{"line":1,"column":352}},{"source":"react/setState_queue.js","name":"stateChange","original":{"line":45,"column":16},"generated":{"line":1,"column":354}},{"source":"react/setState_queue.js","name":"component","original":{"line":45,"column":29},"generated":{"line":1,"column":366}},{"source":"react/setState_queue.js","name":"component","original":{"line":45,"column":29},"generated":{"line":1,"column":368}},{"source":"react/setState_queue.js","name":"component","original":{"line":45,"column":29},"generated":{"line":1,"column":370}},{"source":"react/setState_queue.js","name":"component","original":{"line":47,"column":13},"generated":{"line":1,"column":380}},{"source":"react/setState_queue.js","name":"prevState","original":{"line":47,"column":23},"generated":{"line":1,"column":382}},{"source":"react/setState_queue.js","name":"component","original":{"line":48,"column":12},"generated":{"line":1,"column":394}},{"source":"react/setState_queue.js","name":"prevState","original":{"line":48,"column":22},"generated":{"line":1,"column":396}},{"source":"react/setState_queue.js","name":"Object","original":{"line":48,"column":34},"generated":{"line":1,"column":406}},{"source":"react/setState_queue.js","name":"assign","original":{"line":48,"column":41},"generated":{"line":1,"column":413}},{"source":"react/setState_queue.js","original":{"line":48,"column":48},"generated":{"line":1,"column":420}},{"source":"react/setState_queue.js","name":"component","original":{"line":48,"column":52},"generated":{"line":1,"column":423}},{"source":"react/setState_queue.js","name":"state","original":{"line":48,"column":62},"generated":{"line":1,"column":425}},{"source":"react/setState_queue.js","original":{"line":51,"column":35},"generated":{"line":1,"column":433}},{"source":"react/setState_queue.js","name":"stateChange","original":{"line":51,"column":19},"generated":{"line":1,"column":452}},{"source":"react/setState_queue.js","name":"Object","original":{"line":53,"column":12},"generated":{"line":1,"column":454}},{"source":"react/setState_queue.js","name":"assign","original":{"line":53,"column":19},"generated":{"line":1,"column":461}},{"source":"react/setState_queue.js","name":"component","original":{"line":53,"column":27},"generated":{"line":1,"column":468}},{"source":"react/setState_queue.js","name":"state","original":{"line":53,"column":37},"generated":{"line":1,"column":470}},{"source":"react/setState_queue.js","name":"stateChange","original":{"line":53,"column":44},"generated":{"line":1,"column":476}},{"source":"react/setState_queue.js","name":"component","original":{"line":53,"column":57},"generated":{"line":1,"column":478}},{"source":"react/setState_queue.js","name":"prevState","original":{"line":53,"column":67},"generated":{"line":1,"column":480}},{"source":"react/setState_queue.js","name":"component","original":{"line":53,"column":78},"generated":{"line":1,"column":490}},{"source":"react/setState_queue.js","name":"props","original":{"line":53,"column":88},"generated":{"line":1,"column":492}},{"source":"react/setState_queue.js","name":"Object","original":{"line":56,"column":12},"generated":{"line":1,"column":500}},{"source":"react/setState_queue.js","name":"assign","original":{"line":56,"column":19},"generated":{"line":1,"column":507}},{"source":"react/setState_queue.js","name":"component","original":{"line":56,"column":27},"generated":{"line":1,"column":514}},{"source":"react/setState_queue.js","name":"state","original":{"line":56,"column":37},"generated":{"line":1,"column":516}},{"source":"react/setState_queue.js","name":"stateChange","original":{"line":56,"column":44},"generated":{"line":1,"column":522}},{"source":"react/setState_queue.js","name":"component","original":{"line":59,"column":8},"generated":{"line":1,"column":525}},{"source":"react/setState_queue.js","name":"prevState","original":{"line":59,"column":18},"generated":{"line":1,"column":527}},{"source":"react/setState_queue.js","name":"component","original":{"line":59,"column":30},"generated":{"line":1,"column":537}},{"source":"react/setState_queue.js","name":"state","original":{"line":59,"column":40},"generated":{"line":1,"column":539}},{"source":"react/setState_queue.js","name":"component","original":{"line":62,"column":11},"generated":{"line":1,"column":545}},{"source":"react/setState_queue.js","name":"component","original":{"line":62,"column":11},"generated":{"line":1,"column":550}},{"source":"react/setState_queue.js","name":"renderQueue","original":{"line":62,"column":23},"generated":{"line":1,"column":552}},{"source":"react/setState_queue.js","name":"shift","original":{"line":62,"column":35},"generated":{"line":1,"column":554}},{"source":"react/setState_queue.js","name":"component","original":{"line":63,"column":25},"generated":{"line":1,"column":564}},{"source":"react/setState_queue.js","name":"component","original":{"line":63,"column":25},"generated":{"line":1,"column":566}},{"source":"react/setState_queue.js","name":"component","original":{"line":63,"column":25},"generated":{"line":1,"column":568}},{"source":"react/setState_queue.js","name":"component","original":{"line":63,"column":25},"generated":{"line":1,"column":585}}],"sources":{"react/setState_queue.js":"/**\r\n * 1. 异步更新 state\r\n * 2. 短时间内将多个 state合并到一个（队列当中）\r\n * 3. 一段时间之后，循环遍历，清空队列\r\n */\r\n\r\nimport { renderComponent } from \"../react-dom/index\"\r\n\r\nconst setStateQueue = []\r\n// 保存当前的组件\r\nconst renderQueue = []\r\n\r\nfunction defer( fn ){\r\n    return Promise.resolve().then( fn )\r\n}\r\n\r\nexport function enqueueSetState( stateChange, component ){\r\n\r\n    if( setStateQueue.length === 0 ){\r\n        defer( flush )\r\n        // setTimeout( () => {\r\n        //     flush()\r\n        // }, 60 )\r\n    }\r\n\r\n    // 1. 短时间内 合并多个 setState\r\n    setStateQueue.push({\r\n        stateChange,\r\n        component\r\n    })\r\n    // 如果 renderQueue 里面没有组件，添加到队列中\r\n    let res = renderQueue.some( item => {\r\n        return item === component\r\n    })\r\n    if( !res ){\r\n        // 证明是第一次添加\r\n        renderQueue.push( component )\r\n    }\r\n}\r\n\r\n// 一段时间后\r\nfunction flush(){\r\n    let item, component\r\n    while( item = setStateQueue.shift() ){\r\n        const { stateChange, component } = item\r\n        // 保存之前的状态\r\n        if( !component.prevState ){\r\n            component.prevState = Object.assign({}, component.state)\r\n        }\r\n        // \r\n        if( typeof stateChange === \"function\" ){\r\n            // 函数\r\n            Object.assign( component.state, stateChange( component.prevState, component.props ) )\r\n        } else {\r\n            // 对象\r\n            Object.assign( component.state, stateChange )\r\n        }\r\n        // 赋值\r\n        component.prevState = component.state\r\n    }\r\n\r\n    while( component = renderQueue.shift() ){\r\n        renderComponent( component )\r\n    }\r\n}\r\n"},"lineCount":null}},"error":null,"hash":"df1cadcf57f7e4f91eafca158da860a5","cacheData":{"env":{}}}